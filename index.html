<!DOCTYPE html>
<html lang="ko">

<head>
  <meta charset="UTF-8">
  <title>좀비 아포칼립스 설문</title>
  <script src="https://accounts.google.com/gsi/client" async defer></script>
  <script>

    let userEmail = null;

    function handleCredentialResponse(response) {
      console.log("Google 로그인 응답:", response);
      const payload = JSON.parse(atob(response.credential.split('.')[1]));
      userEmail = payload.email;
      document.getElementById("user-email-display")
        .textContent = "로그인된 이메일: " + userEmail;
    }

    window.onload = () => {
      google.accounts.id.initialize({
        client_id: "169202845035-6hjdeaf921eblb8sj7l0ur690ju94eug.apps.googleusercontent.com",
        callback: handleCredentialResponse,

        // 자동 선택: 이미 동의된 계정이 하나면 별도 입력 없이 자동 로그인
        auto_select: true,

        // 팝업 외부 클릭 시 취소하지 않음
        cancel_on_tap_outside: false,

        // 원탭 컨텍스트('signin' vs 'use')
        context: "signin"
      });

      // One Tap 또는 자동 팝업 실행
      google.accounts.id.prompt();
    };
  </script>
  <script src="https://cdn.jsdelivr.net/npm/emailjs-com@3/dist/email.min.js"></script>
  <script>
    // EmailJS 초기화
    emailjs.init("bzgYD-n0hnEZGoI2o");
    console.log('EmailJS SDK 버전:', emailjs.VERSION);
  </script>
  <style>
    body {
      font-family: 'Segoe UI', sans-serif;
      background: #f0f0f0;
      padding: 30px;
    }

    h1 {
      color: #d9534f;
    }

    .section {
      background: #fff;
      padding: 20px;
      margin-bottom: 20px;
      border-radius: 10px;
      box-shadow: 0 0 5px rgba(0, 0, 0, 0.1);
    }

    label {
      font-weight: bold;
      display: block;
      margin-bottom: 5px;
    }

    textarea,
    input[type="radio"] {
      margin-top: 5px;
    }

    textarea {
      width: 100%;
      height: 60px;
      margin-bottom: 10px;
    }

    button {
      background: #d9534f;
      color: white;
      padding: 12px 24px;
      border: none;
      border-radius: 6px;
      font-size: 16px;
      cursor: pointer;
    }

    #user-email-display {
      font-size: 0.95em;
      color: #555;
      margin-bottom: 10px;
    }

    .info {
      font-size: 0.85em;
      color: gray;
    }
  </style>
</head>

<body>

  <h1>좀비 아포칼립스 설문</h1>

  <!-- 로그인 상태 출력 -->
  <div id="user-email-display">Google 로그인 후 이메일이 여기에 표시됩니다.</div>

  <form id="zombieForm">
        <!-- 0. 작성자 이름 입력 -->
    <div class="section">
        <label>작성자 이름</label>
        <input type="text" name="sender_name" placeholder="이름을 입력하세요" required>
    </div>
    
    <div class="section">
      <label>1. 이런 일이 일어날 줄은</label>
      <label><input type="radio" name="q1" value="꿈에도 몰랐다" required> 꿈에도 몰랐다<br></label>
      <label><input type="radio" name="q1" value="예상했다"> 예상했다<br></label>
      <label><input type="radio" name="q1" value="상상해봤다"> 상상해봤다<br></label>
      <label><input type="radio" name="q1" value="기타"> 기타<br></label>
      <label>이유:</label>
      <textarea name="q1_reason" placeholder="선택한 이유를 적어주세요"></textarea>
    </div>

    <div class="section">
      <label>2. 좀비를 마주치면</label>
      <label><input type="radio" name="q2" value="도망친다" required> 도망친다<br></label>
      <label><input type="radio" name="q2" value="싸운다"> 싸운다<br></label>
      <label><input type="radio" name="q2" value="저항하지 않고 좀비가 된다"> 저항하지 않고 좀비가 된다<br></label>
      <label><input type="radio" name="q2" value="기타"> 기타<br></label>
      <label>이유:</label>
      <textarea name="q2_reason" placeholder="선택한 이유를 적어주세요"></textarea>
    </div>

    <div class="section">
      <label>3. 딱 하나만 얻을 수 있다면</label>
      <label><input type="radio" name="q3" value="충분한 식량" required> 충분한 식량<br></label>
      <label><input type="radio" name="q3" value="쓸만한 무기"> 쓸만한 무기<br></label>
      <label><input type="radio" name="q3" value="안전한 장소"> 안전한 장소<br></label>
      <label><input type="radio" name="q3" value="기타"> 기타<br></label>
      <label>이유:</label>
      <textarea name="q3_reason" placeholder="선택한 이유를 적어주세요"></textarea>
    </div>

    <div class="section">
      <label>4. 생존방식은</label>
      <label><input type="radio" name="q4" value="혼자로도 충분하다" required> 혼자로도 충분하다<br></label>
      <label><input type="radio" name="q4" value="믿을 수 있는 사람들 끼리만"> 믿을 수 있는 사람들 끼리만<br></label>
      <label><input type="radio" name="q4" value="생존자들과 다함께 살아남자"> 생존자들과 다함께 살아남자<br></label>
      <label><input type="radio" name="q4" value="기타"> 기타<br></label>
      <label>이유:</label>
      <textarea name="q4_reason" placeholder="선택한 이유를 적어주세요"></textarea>
    </div>

    <div class="section">
      <label>5. 행동은</label>
      <label><input type="radio" name="q5" value="계획적으로" required> 계획적으로<br></label>
      <label><input type="radio" name="q5" value="즉흥적으로"> 즉흥적으로<br></label>
      <label><input type="radio" name="q5" value="기타"> 기타<br></label>
      <label>이유:</label>
      <textarea name="q5_reason" placeholder="선택한 이유를 적어주세요"></textarea>
    </div>

    <div class="section">
      <label>6. 전투력은</label>
      <label><input type="radio" name="q6" value="아무도 나를 막을 수 없다" required> 아무도 나를 막을 수 없다<br></label>
      <label><input type="radio" name="q6" value="평균보다는 강하다"> 평균보다는 강하다<br></label>
      <label><input type="radio" name="q6" value="평균보다는 약하다"> 평균보다는 약하다<br></label>
      <label><input type="radio" name="q6" value="싸움은 무리"> 싸움은 무리<br></label>
      <label><input type="radio" name="q6" value="기타"> 기타<br></label>
      <label>이유:</label>
      <textarea name="q6_reason" placeholder="선택한 이유를 적어주세요"></textarea>
    </div>

    <div class="section">
      <label>7. 정신력은</label>
      <label><input type="radio" name="q7" value="무슨일이 일어나더라도 버틴다" required> 무슨일이 일어나더라도 버틴다<br></label>
      <label><input type="radio" name="q7" value="적당히 버틸 수 있다"> 적당히 버틸 수 있다<br></label>
      <label><input type="radio" name="q7" value="오래 버틸 수는 없다"> 오래 버틸 수는 없다<br></label>
      <label><input type="radio" name="q7" value="쉽게 붕괴된다"> 쉽게 붕괴된다<br></label>
      <label><input type="radio" name="q7" value="기타"> 기타<br></label>
      <label>이유:</label>
      <textarea name="q7_reason" placeholder="선택한 이유를 적어주세요"></textarea>
    </div>

    <div class="section">
      <label>8. 타인의 위험 앞에서</label>
      <label><input type="radio" name="q8" value="뭐가 어쨌든 일단 구한다" required> 뭐가 어쨌든 일단 구한다<br></label>
      <label><input type="radio" name="q8" value="상황과 경우에 따라 결정한다"> 상황과 경우에 따라 결정한다<br></label>
      <label><input type="radio" name="q8" value="소중한 사람만 구한다"> 소중한 사람만 구한다<br></label>
      <label><input type="radio" name="q8" value="구하지 않는다"> 구하지 않는다<br></label>
      <label><input type="radio" name="q8" value="기타"> 기타<br></label>
      <label>이유:</label>
      <textarea name="q8_reason" placeholder="선택한 이유를 적어주세요"></textarea>
    </div>

    <div class="section">
      <label>9. 희생은</label>
      <label><input type="radio" name="q9" value="상대와 무관하게 할 수 있다" required> 상대와 무관하게 할 수 있다<br></label>
      <label><input type="radio" name="q9" value="상대에 따라 결정한다"> 상대에 따라 결정한다<br></label>
      <label><input type="radio" name="q9" value="필요하지 않다면 하지 않는다"> 필요하지 않다면 하지 않는다<br></label>
      <label><input type="radio" name="q9" value="하지 않는다"> 하지 않는다<br></label>
      <label><input type="radio" name="q9" value="기타"> 기타<br></label>
      <label>이유:</label>
      <textarea name="q9_reason" placeholder="선택한 이유를 적어주세요"></textarea>
    </div>

    <div class="section">
      <label>10. 치료는</label>
      <label><input type="radio" name="q10" value="능숙하게 할 수 있다" required> 능숙하게 할 수 있다<br></label>
      <label><input type="radio" name="q10" value="엉성하지만 할 수 있다"> 엉성하지만 할 수 있다<br></label>
      <label><input type="radio" name="q10" value="약을 바르는 정도만"> 약을 바르는 정도만<br></label>
      <label><input type="radio" name="q10" value="할 수 없다"> 할 수 없다<br></label>
      <label><input type="radio" name="q10" value="기타"> 기타<br></label>
      <label>이유:</label>
      <textarea name="q10_reason" placeholder="선택한 이유를 적어주세요"></textarea>
    </div>

    <div class="section">
      <label>11. 동료를 위해 할 수 있는 것</label>
      <label><input type="checkbox" name="q11" value="다른 생존자들과 협상하여 식량 등을 획득" required> 다른 생존자들과 협상하여 식량 등을 획득<br></label>
      <label><input type="checkbox" name="q11" value="다른 생존자들의 식량을 도둑질"> 다른 생존자들의 식량을 도둑질<br></label>
      <label><input type="checkbox" name="q11" value="좀비들과 전투"> 좀비들과 전투<br></label>
      <label><input type="checkbox" name="q11" value="살인"> 살인<br></label>
      <label><input type="checkbox" name="q11" value="기타"> 기타<br></label>
      <label>이유:</label>
      <textarea name="q11_reason" placeholder="선택한 이유를 적어주세요"></textarea>
    </div>

    <div class="section">
      <label>12. 동료가 물릴 위기에 처했다</label>
      <label><input type="radio" name="q12" value="대신 물려줄 수 있다" required> 대신 물려줄 수 있다<br></label>
      <label><input type="radio" name="q12" value="동료가 물리더라도 함께 다닐 수 있다"> 동료가 물리더라도 함게 다닐 수 있다<br></label>
      <label><input type="radio" name="q12" value="동료가 물린다면 동료를 버릴 수 있다"> 동료가 물린다면 동료를 버릴 수 있다<br></label>
      <label><input type="radio" name="q12" value="동료가 물리면 죽일 수 있다"> 동료가 물리면 죽일 수 있다<br></label>
      <label><input type="radio" name="q12" value="기타"> 기타<br></label>
      <label>이유:</label>
      <textarea name="q12_reason" placeholder="선택한 이유를 적어주세요"></textarea>
    </div>

    <div class="section">
      <label>13. 내가 곧 좀비가 된다면 동료에게</label>
      <label><input type="radio" name="q13" value="나를 버리라고 한다" required> 나를 버리라고 한다<br></label>
      <label><input type="radio" name="q13" value="나를 데려가라고 한다"> 나를 데려가라고 한다<br></label>
      <label><input type="radio" name="q13" value="나에게 물려달라고 한다"> 나에게 물려달라고 한다<br></label>
      <label><input type="radio" name="q13" value="나를 죽여달라고 한다"> 나를 죽여달라고 한다<br></label>
      <label><input type="radio" name="q13" value="기타"> 기타<br></label>
      <label>이유:</label>
      <textarea name="q13_reason" placeholder="선택한 이유를 적어주세요"></textarea>
    </div>

    <div class="section">
      <label>14. 좀비사테 끝에서 나는</label>
      <label><input type="radio" name="q14" value="생존자" required> 생존자<br></label>
      <label><input type="radio" name="q14" value="좀비"> 좀비<br></label>
      <label><input type="radio" name="q14" value="시체"> 시체<br></label>
      <label><input type="radio" name="q14" value="기타"> 기타<br></label>
      <label>이유:</label>
      <textarea name="q14_reason" placeholder="선택한 이유를 적어주세요"></textarea>
    </div>

    <button type="submit">제출 및 이메일 전송</button>
  </form>

  <p class="info">※ 이 설문은 Google 로그인 계정을 통해 이메일을 자동 수집합니다. 이메일은 결과 전송 이외의 용도로 사용되지 않습니다.</p>

  <script>
    // 폼 엘리먼트 획득
    const form = document.getElementById('zombieForm');
    console.log('폼 엘리먼트:', form);

    form.addEventListener('submit', e => {
      e.preventDefault();
      console.log('▶ submit 이벤트 발생');
      console.log('userEmail:', userEmail);

      // ① FormData 생성
      const fd = new FormData(form);

      // ② data 객체 초기화 (항상 전달할 user_email 먼저 세팅)
      const data = { user_email: userEmail };

      // ③ 각 필드별로 getAll() 사용 → 다수 값은 배열, 단일 값은 문자열
      for (const key of new Set(fd.keys())) {
        const values = fd.getAll(key);
        data[key] = values.length > 1 ? values : values[0];
      }

      // ④ 체크박스 배열을 문자열로 합치고 싶다면(선택 사항)
      if (Array.isArray(data.q11)) {
        data.q11 = data.q11.join(', ');
      }

      console.log('→ 전송 페이로드:', data);

      // ⑤ EmailJS 전송
      emailjs.send('service_a9pxlw2', 'template_4bh8fyd', data)
        .then(res => console.log('✔ 전송 성공', res))
        .catch(err => console.error('✖ 전송 실패', err));
    });
  </script>

</body>

</html>
